<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plasma Dynamics Research Lab: 30° Conical Geometry</title>
    <!-- External Libraries: Tailwind for styling, Chart.js for data viz -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #0c0c0e; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 4px; }
        #simCanvas { background-color: #050505; border-radius: 1rem; width: 100%; height: 450px; cursor: crosshair; }
        .glass-panel { background: rgba(24, 24, 27, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(63, 63, 70, 0.5); }
    </style>
    <!-- Chosen Palette: Slate (Lab Standard) + Indigo (Electronic) + Amber (Thermal Conduction) -->
    <!-- Application Structure Plan: 
         1. Energetic Summary: Quantifying the 337.5J loss for the 4mm blunt baseline.
         2. Comparison: Flat (4mm) vs 30-Degree Cone.
         3. Kinetic Simulation: Particle-based ionic drift showing convergence at the cone apex.
         Rationale: This version is optimized for GitHub hosting with all AI API logic removed.
         The physics focuses on the divergence of the electric field ($E \propto 1/r^2$) for the 30-degree tip. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-[#0c0c0e] text-zinc-300 font-sans leading-relaxed selection:bg-indigo-500/30">

    <nav class="bg-zinc-900 border-b border-zinc-800 shadow-xl sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between h-16 items-center">
            <div class="flex items-center">
                <span class="text-xl mr-2 text-indigo-500 font-bold">⚡</span>
                <span class="font-bold text-lg tracking-tight text-white uppercase">Plasma <span class="text-indigo-500">Kinetics</span> Lab</span>
            </div>
            <div class="flex items-center space-x-10 text-[10px] font-mono">
                <div class="flex flex-col">
                    <span class="text-zinc-500">CAP_BANK</span>
                    <span class="text-zinc-100">1.0 µF</span>
                </div>
                <div class="flex flex-col">
                    <span class="text-zinc-500">SALINITY</span>
                    <span class="text-amber-500">700 µS/cm</span>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-12">

        <!-- Energetics Metrics -->
        <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <div class="glass-panel p-6 rounded-2xl flex flex-col justify-center">
                <h4 class="text-[10px] font-bold text-zinc-500 uppercase mb-1">Stored Energy (t=0)</h4>
                <div class="text-3xl font-black text-white">450.0 J</div>
                <p class="text-[10px] text-zinc-600 mt-2">Initial potential at 30.0 kV</p>
            </div>
            <div class="glass-panel p-6 rounded-2xl border-amber-900/30 flex flex-col justify-center">
                <h4 class="text-[10px] font-bold text-amber-500 uppercase mb-1">Ohmic Bleed Loss</h4>
                <div class="text-3xl font-black text-amber-500" id="statLoss">337.5 J</div>
                <p class="text-[10px] text-amber-700 mt-2">Drained before plasma formation</p>
            </div>
            <div class="glass-panel p-6 rounded-2xl border-indigo-900/30 flex flex-col justify-center">
                <h4 class="text-[10px] font-bold text-indigo-400 uppercase mb-1">Arc Energy</h4>
                <div class="text-3xl font-black text-indigo-400" id="statArc">112.5 J</div>
                <p class="text-[10px] text-indigo-700 mt-2">Remaining energy at breakdown</p>
            </div>
            <div class="glass-panel p-6 rounded-2xl flex flex-col justify-center">
                <h4 class="text-[10px] font-bold text-zinc-500 uppercase mb-1">Discharge Time</h4>
                <div class="text-3xl font-black text-zinc-200" id="statTime">50 µs</div>
                <p class="text-[10px] text-zinc-500 mt-2">Initiation delay (Lag)</p>
            </div>
        </section>

        <!-- Main Charting and Analysis -->
        <section class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <div class="lg:col-span-8 glass-panel rounded-3xl p-8">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-xl font-bold text-white uppercase tracking-tight">Capacitor Discharge Analysis</h2>
                    <div class="text-[10px] font-mono px-3 py-1 bg-zinc-800 rounded">RC τ: 72.1 µs</div>
                </div>
                <div style="position: relative; width: 100%; height: 350px;">
                    <canvas id="energyChart"></canvas>
                </div>
            </div>

            <div class="lg:col-span-4 space-y-6">
                <div class="glass-panel rounded-3xl p-8 h-full">
                    <h3 class="text-sm font-bold text-white uppercase tracking-widest mb-6 pb-2 border-b border-zinc-800">Geometry Impact</h3>
                    <div class="space-y-6">
                        <div>
                            <h4 class="text-xs font-bold text-indigo-400 mb-2">30° Conical Tip</h4>
                            <p class="text-[11px] text-zinc-400 leading-relaxed">
                                A 30° taper increases the field enhancement factor ($\beta$) while maintaining electrode longevity. The convergent field funnels ions toward the apex, reaching critical space charge density faster than a flat face.
                            </p>
                        </div>
                        <div class="p-4 bg-zinc-800/50 rounded-xl border border-zinc-700">
                            <div class="text-[10px] font-bold text-zinc-500 uppercase mb-2">Ionic Current</div>
                            <div class="text-xl font-mono text-white">~300 A Peak</div>
                        </div>
                        <div class="p-4 bg-zinc-800/50 rounded-xl border border-zinc-700">
                            <div class="text-[10px] font-bold text-zinc-500 uppercase mb-2">Field Divergence</div>
                            <p class="text-[10px] text-zinc-500 leading-tight">Increased local gradient $\nabla E$ reduces initiation lag.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Interactive Simulator -->
        <section class="bg-black rounded-3xl overflow-hidden border border-zinc-800 shadow-2xl">
            <div class="grid grid-cols-1 md:grid-cols-4">
                <div class="p-8 md:border-r border-zinc-800 bg-zinc-900/40">
                    <h2 class="text-2xl font-black text-white mb-2">Pulse Sim</h2>
                    <p class="text-zinc-500 text-xs mb-10">4.0mm Gap. Simulating ion transport and heterocharge buildup.</p>
                    
                    <div class="space-y-6">
                        <div class="p-4 bg-zinc-800/50 rounded-xl border border-zinc-700">
                            <label class="text-[10px] text-zinc-500 uppercase font-bold mb-3 block">Anode Geometry</label>
                            <div class="flex gap-2">
                                <button onclick="setMode('blunt')" id="btnBlunt" class="flex-1 py-2 rounded bg-indigo-600 text-white text-[10px] font-bold uppercase transition">Flat</button>
                                <button onclick="setMode('conical')" id="btnConical" class="flex-1 py-2 rounded bg-zinc-700 text-white text-[10px] font-bold uppercase transition">30° Cone</button>
                            </div>
                        </div>

                        <div class="p-4 bg-zinc-800/50 rounded-xl border border-zinc-700">
                            <div class="flex justify-between text-[10px] font-bold text-zinc-500 mb-2 uppercase">Capacitor Voltage</div>
                            <div class="text-2xl font-mono text-indigo-400" id="simVolt">30.0 kV</div>
                            <div class="w-full h-1 bg-zinc-700 rounded mt-3 overflow-hidden">
                                <div id="simVoltBar" class="h-full bg-indigo-500" style="width: 100%"></div>
                            </div>
                        </div>

                        <div class="p-4 bg-zinc-800/50 rounded-xl border border-zinc-700">
                            <div class="flex justify-between text-[10px] font-bold text-zinc-500 mb-2 uppercase">Dissipated Heat</div>
                            <div class="text-2xl font-mono text-amber-500" id="simHeat">0.0 J</div>
                        </div>
                    </div>

                    <button id="btnTrigger" class="mt-10 w-full py-5 bg-white text-black rounded-2xl font-black uppercase text-xs hover:bg-zinc-200 transition shadow-2xl active:scale-95">
                        Initiate Pulse
                    </button>
                </div>
                <div class="md:col-span-3 p-8 relative flex items-center justify-center">
                    <canvas id="simCanvas"></canvas>
                    <div id="arcFlash" class="absolute inset-0 bg-white opacity-0 transition-opacity pointer-events-none duration-100"></div>
                    <div class="absolute bottom-6 right-8 text-[9px] font-mono text-zinc-600 uppercase">4.0mm Gap Simulation</div>
                </div>
            </div>
        </section>

    </main>

    <footer class="max-w-7xl mx-auto px-4 py-12 text-center text-zinc-700 text-[10px] uppercase tracking-[0.2em] border-t border-zinc-900">
        Plasma Research Environment | Experimental Data Synthesis
    </footer>

    <script>
        const state = {
            v0: 30, 
            delay: 50,
            cap: 1e-6,
            tau: 72.13, 
            mode: 'blunt',
            isAnimating: false
        };

        let energyChartInstance = null;
        function initCharts() {
            const ctx = document.getElementById('energyChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (energyChartInstance) {
                energyChartInstance.destroy();
            }

            const labels = Array.from({length: 61}, (_, i) => i);
            const vData = labels.map(t => (t <= state.delay) ? 30 * Math.exp(-t / 72.13) : null);
            const lossData = labels.map(t => {
                if (t > state.delay) return null;
                const v = 30 * Math.exp(-t / 72.13);
                return 0.5 * (900 - v*v); 
            });

            energyChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        { label: 'Voltage (kV)', data: vData, borderColor: '#6366f1', borderWidth: 3, pointRadius: 0, yAxisID: 'y' },
                        { label: 'Energy Loss (J)', data: lossData, borderColor: '#f59e0b', borderWidth: 2, pointRadius: 0, fill: true, backgroundColor: 'rgba(245, 158, 11, 0.05)', yAxisID: 'y1' }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { grid: { color: '#18181b' }, title: { display: true, text: 'Time (µs)', color: '#52525b' } },
                        y: { position: 'left', title: { display: true, text: 'Voltage (kV)', color: '#6366f1' }, grid: { color: '#18181b' }, min: 0, max: 35 },
                        y1: { position: 'right', title: { display: true, text: 'Waste Heat (J)', color: '#f59e0b' }, grid: { display: false }, min: 0, max: 450 }
                    },
                    plugins: { legend: { labels: { color: '#a1a1aa', font: { size: 10 } } } }
                }
            });
        }

        let simCtx, simCanvas;
        let ions = [];

        function initSim() {
            simCanvas = document.getElementById('simCanvas');
            simCtx = simCanvas.getContext('2d');
            const resize = () => {
                simCanvas.width = simCanvas.parentElement.clientWidth;
                simCanvas.height = 450;
                drawStage();
            };
            window.addEventListener('resize', resize);
            resize();
            document.getElementById('btnTrigger').addEventListener('click', runPulse);
        }

        function setMode(mode) {
            state.mode = mode;
            state.delay = mode === 'blunt' ? 50 : 22; // 30 deg cone estimate
            
            // Update UI
            document.getElementById('btnBlunt').className = mode === 'blunt' ? 'flex-1 py-2 rounded bg-indigo-600 text-white text-[10px] font-bold uppercase transition' : 'flex-1 py-2 rounded bg-zinc-800 text-white text-[10px] font-bold uppercase transition';
            document.getElementById('btnConical').className = mode === 'conical' ? 'flex-1 py-2 rounded bg-indigo-600 text-white text-[10px] font-bold uppercase transition' : 'flex-1 py-2 rounded bg-zinc-800 text-white text-[10px] font-bold uppercase transition';
            
            // Update Metrics
            const vLag = 30 * Math.exp(-state.delay / 72.13);
            const loss = 0.5 * (900 - vLag * vLag);
            document.getElementById('statLoss').innerText = loss.toFixed(1) + " J";
            document.getElementById('statArc').innerText = (450 - loss).toFixed(1) + " J";
            document.getElementById('statTime').innerText = state.delay + " µs";
            
            initCharts(); // Redraw chart with new lag line
            drawStage();
        }

        function drawStage() {
            const w = simCanvas.width;
            const h = simCanvas.height;
            simCtx.fillStyle = '#050505';
            simCtx.fillRect(0, 0, w, h);
            
            simCtx.fillStyle = '#27272a';
            if (state.mode === 'blunt') {
                // 4mm Flat blunt
                simCtx.fillRect(w/2 - 40, 0, 80, 60);
            } else {
                // 30 degree cone
                simCtx.beginPath();
                simCtx.moveTo(w/2 - 40, 0);
                simCtx.lineTo(w/2 + 40, 0);
                simCtx.lineTo(w/2, 120); // Longer taper
                simCtx.fill();
            }
            // Ground Plane
            simCtx.fillRect(w/2 - 120, h - 20, 240, 20);
        }

        function runPulse() {
            if (state.isAnimating) return;
            state.isAnimating = true;
            
            let t = 0;
            const dt = 0.5;
            ions = Array.from({length: 150}, () => ({
                x: (Math.random()-0.5) * (state.mode === 'blunt' ? 80 : 200) + simCanvas.width/2,
                y: Math.random() * (simCanvas.height-120) + 80,
                type: Math.random() > 0.5 ? 1 : -1
            }));

            function frame() {
                drawStage();
                const vNow = 30 * Math.exp(-t / state.tau);
                const currentLoss = 0.5 * (900 - vNow*vNow);

                document.getElementById('simVolt').innerText = vNow.toFixed(1) + ' kV';
                document.getElementById('simVoltBar').style.width = (vNow / 30 * 100) + '%';
                document.getElementById('simHeat').innerText = currentLoss.toFixed(1) + ' J';

                ions.forEach(ion => {
                    let dx = 0;
                    let dy = ion.type * (vNow / 30) * 3.5;
                    
                    if (state.mode === 'conical') {
                        // Ions follow field lines towards the apex
                        const distToApex = Math.sqrt(Math.pow(simCanvas.width/2 - ion.x, 2) + Math.pow(120 - ion.y, 2));
                        if (distToApex > 10) {
                            dx = (simCanvas.width/2 - ion.x) / distToApex * 2.5 * (vNow/30);
                            dy = (120 - ion.y) / distToApex * 2.5 * (vNow/30);
                        }
                    }
                    ion.x += dx;
                    ion.y += dy;

                    const boundaryY = state.mode === 'blunt' ? 60 : 120;
                    if (ion.y < boundaryY) ion.y = boundaryY;
                    if (ion.y > simCanvas.height-20) ion.y = simCanvas.height-20;

                    simCtx.fillStyle = ion.type > 0 ? '#8b5cf6' : '#f59e0b';
                    simCtx.beginPath(); simCtx.arc(ion.x, ion.y, 1.2, 0, Math.PI * 2); simCtx.fill();
                });

                t += dt;
                if (t < state.delay) {
                    requestAnimationFrame(frame);
                } else {
                    simCtx.strokeStyle = '#fff'; simCtx.lineWidth = 6; simCtx.shadowBlur = 40; simCtx.shadowColor = '#6366f1';
                    simCtx.beginPath();
                    simCtx.moveTo(simCanvas.width/2, state.mode === 'blunt' ? 60 : 120);
                    let cx = simCanvas.width/2;
                    for(let y = (state.mode === 'blunt' ? 70 : 130); y < simCanvas.height-20; y+=25) {
                        cx += (Math.random()-0.5)*40;
                        simCtx.lineTo(cx, y);
                    }
                    simCtx.stroke();
                    document.getElementById('arcFlash').style.opacity = '1';
                    setTimeout(() => { document.getElementById('arcFlash').style.opacity = '0'; state.isAnimating = false; drawStage(); }, 200);
                }
            }
            frame();
        }

        window.onload = () => { initSim(); setMode('blunt'); };
    </script>
</body>
</html>
